<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
</head>
<body>

<div>
飞行大乱斗 - V1.0
</div>
<div>
作者： 邓高山
</div>

<canvas id="id-canvas" width="300" height="900" style="border: 1px black solid;">
</canvas>
</br>

<div>
    当前是：玩家1 回合
</div>
</br>

<div>
    资源统计：
    <div id="id-statistics">
    石油总量： 0 
    占领领地： 1 
    石油产能：2
    战斗机数量： 10 
    </div>
</div>
</br>
<div>

1 开采（1单位产能 = 1次掷骰子机会）</br>
<button type="button" onclick="mine()" >开采</button></br>

<div id="id-mine-result">
</div>
<div id="id-income-result">
</div>

</br>
2 生产(只能从己方领地生产，每单位飞机消耗10单位石油)</br>
从区域
<select name="move-from"> 
<option value="1">1</option> 
<option value="2">2</option> 
<option value="3">3</option> 
<option value="4">4</option> 
<option value="5">5</option> 
<option value="6">6</option>
<option value="7">7</option> 
<option value="8">8</option> 
<option value="9">9</option>
</select>
生产飞机<input/>架
<button type="button" onclick="produce()">确认</button>
<button type="button" onclick="produceMax()">最大</button>

</br></br>
3 移动 / 攻击</br>
从区域
<select name="move-from"> 
<option value="1">1</option> 
<option value="2">2</option> 
<option value="3">3</option> 
<option value="4">4</option> 
<option value="5">5</option> 
<option value="6">6</option>
<option value="7">7</option> 
<option value="8">8</option> 
<option value="9">9</option>
</select> 
到区域
<select name="move-from"> 
<option value="1">1</option> 
<option value="2">2</option> 
<option value="3">3</option> 
<option value="4">4</option> 
<option value="5">5</option> 
<option value="6">6</option>
<option value="7">7</option> 
<option value="8">8</option> 
<option value="9">9</option>
</select> </br>

<label type="">派遣数量:</button>
<input/>
</br>
<button type="">确认</button></br></br>

<button type="">回合结束</button></br></br>

</div>


</body>

<script type="text/javascript">

var log = console.log.bind(console)
var canvas = document.querySelector('#id-canvas')
var ctx = canvas.getContext('2d')


//游戏
var FlyGame = function(){
    var o ={
        players: {},
        current: 1,
        ifMined: false,
        maps : {},
    }

    o.getCurrentPlayer = function(){
        if(o.current == 1){
            return o.players[0]
        }
        if(o.current == 2){
            return o.players[1]
        }
    }

    //更新资源统计视图
    o.updateStat = function(){
        var player = o.getCurrentPlayer()
        var show = " 石油总量： "+player.oilSum+" 占领领地： "+player.placeSum+" 石油产能："+player.oilCapacity+" 战斗机数量： "+player.planeSum

        document.getElementById('id-statistics').innerHTML = show;
    }
    return o
}

//玩家
var Player = function(){
    var o ={
        num: 1,
        oilSum: 0,      //石油资源总量
        placeSum: 1,    //领地总量
        planeSum: 10,   //战斗机总量

        oilCapacity: 2, //产能
    }   

    o.mine = function(position){
        results = new Array()
        for(var i=0; i< o.oilCapacity;i++){
            num = 1 + parseInt(Math.random()*6, 10)
            results.push(num)
        }
        return results
    }

    return o
}

//地图块
var Block = function(){
    var o ={
        num: 1,
        x: 0,
        y: 0,
        width: 100,
        height: 300,
        belong: 0, //所属玩家，0中立
        capacity: 1, //产能，
        plane: 0, //领地的战斗机数量
    }

    o.create = function(number){
        o.num = number
        o.x = (number - 1) % 3 * 100
        o.y = Math.floor( (number-1)/3 ) * 300
    }

    o.drawBlock = function(){
       
        ctx.strokeRect(o.x, o.y, o.width, o.height);

        if(o.belong == 1){
            ctx.fillStyle = "green";
            ctx.fillRect(o.x, o.y, o.width, o.height);  
        }else if (o.belong == 2){
            ctx.fillStyle = "blue";
            ctx.fillRect(o.x, o.y, o.width, o.height); 
        }

        //抬头
        ctx.font = '15px';
        ctx.strokeText('区域：' + o.num, o.x , o.y + 15)   
        
        //资源
        var img = new Image()
        img.src = 'oil.png'   
        img.onload = function(){
            ctx.drawImage(img,o.x + 1,o.y + 20 ,30,30)
        }

        //显示产能
        ctx.font = '30px';
        ctx.strokeText( o.capacity,o.x + 35,o.y + 40 ,30,30)
        
        //布防
        var img2 = new Image()
        img2.src = 'airplane.png'   
        img2.onload = function(){
            ctx.drawImage(img2,o.x + 1,o.y + 55 ,30,30)
        } 
        //显示飞机数量
        ctx.font = '30px';
        ctx.strokeText( o.plane,o.x + 35,o.y + 75 ,30,30)

    }
    return o
}


var __main = function(){
    init()
}

//根据骰子结果计算金币
function calculateIncome(results){
    //3个筛子以下
    if(results.length<3){
        if(results[0] == results[1]){
            return results[0] * results[0]
        }
        return results[0] + results[1]
    }
}

//开采
function mine(){
    if(game.ifMined == false){

        player =  game.getCurrentPlayer()
        //投骰子
        var results = player.mine()
        //显示骰子结果
        document.getElementById('id-mine-result').innerHTML = "骰子结果："+results;

        //计算收益
        var income = calculateIncome(results)
        //显示收益
        document.getElementById('id-income-result').innerHTML = "获得石油数量："+income;
        game.ifMined = true

        player.oilSum += income

        game.updateStat()
       

    }else{
        document.getElementById('id-mine-result').innerHTML = "本回合不能再开采！";
        document.getElementById('id-income-result').innerHTML = "";
    }
}

//生产飞机
function produce(){

}

//全局控制器
var game = new FlyGame()


var init = function(){

    maps = new Array()

    for(var i=1;i<=9;i++){
        var block = new Block()
        block.create(i)
        maps.push(block)
    }

    //初始化玩家
    player1 = new Player()
    player2 = new Player()
    game.players = new Array()
    game.players.push(player1)
    game.players.push(player2)

    //初始领地归属
    maps[0].belong = 1
    maps[0].plane = 10
    maps[8].belong = 2
    maps[8].plane = 10

    maps[0].capacity = 2
    maps[8].capacity = 2
    maps[2].capacity = 2
    maps[6].capacity = 2

    maps[4].capacity = 3
    //初始领地资源

    //绘图
    for(var i=0;i<9;i++){
        maps[i].drawBlock()
    }

    game.maps = maps

}

__main()

</script>

</html>